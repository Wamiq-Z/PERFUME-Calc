{% extends "base.html" %} {% block content %}
<h2>Perfume Calculator</h2>
<script>
async function removeCompound(compoundId) {
  try {
    const response = await fetch(`/remove_from_calculator/${compoundId}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      }
    });

    if (response.ok) {
      const btn = document.querySelector(`button[data-id="${compoundId}"]`);
      const row = btn.closest("tr");
      row.remove();
    } else {
      console.error("Failed to remove compound");
    }
  } catch (err) {
    console.error("Error:", err);
  }
}
</script>

<form method="post" action="{{ url_for('calc') }}">
  <table border="1">
    <tr>
      <th>Compound</th>
      <th>Price/kg</th>
      <th>Quantity (kg)</th>
      <th>Actions</th>
    </tr>
    {% for compound in compounds %}
    <tr>
      <td>{{ compound.name }}</td>
      <td>Rs. {{ compound.price_perkg }}</td>
      <td>
        <input
          type="number"
          step="0.01"
          name="{{ compound.id }}"
          value="{{ request.form.get(compound.id | string, '') }}"
        />
      </td>
      <td>
        <button type="button" 
                class="btn-remove" 
                data-id="{{ compound.id }}" 
                onclick="removeCompound({{ compound.id }})">
          Remove Compound
        </button>
      </td>
    </tr>
    {% endfor %}
  </table>
  <button type="submit">Calculate</button>
</form>

{% if selected %}
<h3>Selected Compounds:</h3>
<ul>
  {% for name, qty, price_kg, price in selected %}
  <li>{{ name }} — {{ qty }} kg × Rs. {{ price_kg }} = Rs. {{ price }}</li>
  {% endfor %}
</ul>
<h3>Total Quantity: {{ "%.2f"|format(total_quantity) }} kgs</h3>
<h3>Quantity in grams: {{ "%.3f"|format(total_qty_g) }} g</h3>
<h3>Price per kg: Rs. {{ "%.2f"|format(avg_price_per_kg) }}</h3>
<h2>Total Price: Rs. {{ total }}</h2>
{% endif %} {% endblock %}
